angular.module('app.filters', []);
angular.module('app.views', []);
angular.module('app.constants', []);
angular.module('app.directives', ['infinite-scroll', 'app.filters']);
angular.module('app.services', ['app.constants', 'ngResource']);

var app = angular.module('app', ['app.services', 'app.directives', 'app.views', 'app.filters', 'ngRoute']);

app.config(["$routeProvider", function($routeProvider) {
    $routeProvider.when('/', { templateUrl : 'profile-details.html' });
}]);
/* globals angular:false */

var constants;
constants = angular.module('app.constants');

constants.constant('FLICKR_API', 'https://api.flickr.com/services/rest/');

constants.constant('FLICKR_KEY', '61e16e8a06566762575cafdf5f165b79');

/* globals angular:false */

var constants;
constants = angular.module('app.constants');

constants.constant('TWITTER_API', 'http://localhost:3000');

constants.constant('TWITTER_QUANTITY_TWEETS_GET', 200);

var filters = angular.module('app.filters');

filters.filter('hashtag', function() {
    return function (hash) {
        return hash ? '#' + hash : '';
    };
});
var filters = angular.module('app.filters');

filters.filter('removeText', function() {
    return function (text, remove) {
        return text ? text.replace(remove, '') : '';
    };
});
var filters = angular.module('app.filters');

filters.filter('screenName', function() {
    return function (userScreenName) {
        return userScreenName ? '@' + userScreenName : '';
    };
});
var app = angular.module('app.directives');

app.controller('profileDetailsController', ["$q", "helpService", "twitter", function profileDetailsController($q, helpService, twitter) {

    $q.all([twitter.getTweets(), twitter.getUser()]).then(helpService.spread(function (tweets, user) {
        this.tweets = tweets;
        this.user = user;
    }.bind(this)));

    this.tweetsHeaderOptions = [
        { text: 'Tweets', active: true, exclude_replies: true, only_media: false },
        { text: 'Tweets & replies', active: false, exclude_replies: false, only_media: false },
        { text: 'Media', active: false, exclude_replies: false, only_media: true }
    ];

    this.moreTweets = function moreTweets() {
        var option = helpService.find(this.tweetsHeaderOptions, function (option) {
            return option.active;
        });
        twitter.moreTweets(this.tweets, option.exclude_replies, option.only_media);
    };

    this.selectHeaderOptionsActive = function selectHeaderOptionsActive(indexSelected) {
        helpService.forEach(this.tweetsHeaderOptions, function (option, index) {
            option.active = index === indexSelected;
        });
        this.tweets = [];
        this.moreTweets();
    };



}]);
/* globals angular:false */

var services;
services = angular.module('app.services');

services.factory('FlickrService', ["$resource", "FLICKR_API", "FLICKR_KEY", function FlickrService($resource, FLICKR_API, FLICKR_KEY) {
    return $resource(FLICKR_API, {}, {
        photos: {
            method: 'GET',
            url: FLICKR_API,
            isArray: false,
            params: {
                method: 'flickr.photos.search',
                api_key: FLICKR_KEY,
                page: 1,
                format: 'json',
                nojsoncallback: 1,
                per_page: 1
            }
        }
    });
}]);

services.factory('flickr', ["FlickrService", function flickr(FlickrService) {
    return {
        getPhotos: function getPhotos(tags) {
            return FlickrService.photos({ tags: tags }).$promise;
        },
        getPhotoUrl: function getPhotoUrl(photo) {
            return 'https://farm' + photo.farm + '.staticflickr.com/' + photo.server + '/' + photo.id + '_' + photo.secret + '.jpg';
        }
    }
}]);
var services;
services = angular.module('app.services');

services.factory('helpService', function helpService() {

    return {
        first: function first(collection) {
            return collection[0];
        },
        forEach: function forEach(collection, fn) {
            if (this.isEmpty(collection)) return;
            for (var i = 0; i < collection.length; i++) {
                fn(collection[i], i);
            }
        },
        find: function find(collection, fn) {
            if (this.isEmpty(collection)) return;
            var result;
            for (var i = 0; i < collection.length; i++) {
                if (fn(collection[i], i)) {
                    result = collection[i];
                    break;
                }
            }
            return result;
        },
        isBool: function isBool(variable) {
            return typeof(variable) === 'boolean';
        },
        isEmpty: function (collection) {
            return (collection && collection.length === 0) || typeof collection === 'undefined';
        },
        last: function last(collection) {
            return collection[collection.length - 1];
        },
        random: function ramdom(limMax) {
            return Math.floor((Math.random() * limMax) + 1);
        },
        spread: function spread(func) {
            return function(array) {
                return func.apply(this, array);
            };
        }
    }

});
/* globals angular:false */

var services;
services = angular.module('app.services');

services.factory('TwitterService', ["$resource", "TWITTER_API", function TwitterService($resource, TWITTER_API) {
    return $resource(TWITTER_API, {}, {
        tweets: {
            method: 'GET',
            url: TWITTER_API + '/tweets',
            isArray: true
        },
        user: {
            method: 'GET',
            url: TWITTER_API + '/user',
            isArray: false
        }
    });
}]);

services.factory('twitter', ["helpService", "TwitterService", "TWITTER_QUANTITY_TWEETS_GET", function twitter(helpService, TwitterService, TWITTER_QUANTITY_TWEETS_GET) {
    
    return {
        _readingTweets: false,
        moreTweets: function moreTweets(arrayTweets, excludeReplies, onlyMedia) {
            if (this._readingTweets) return;
            var max_id = arrayTweets.length ? (helpService.last(arrayTweets)).id_str : null;
            this._readingTweets = true;
            this.getTweets(TWITTER_QUANTITY_TWEETS_GET + 1, excludeReplies, max_id).then(function(response) {
                if (arrayTweets.length) response.shift();
                helpService.forEach(response, function(tweet) {
                    if (onlyMedia && helpService.isEmpty(tweet.entities.hashtags) && helpService.isEmpty(tweet.entities.media)) return;
                    arrayTweets.push(tweet);
                });
                this._readingTweets = false;
            }.bind(this)).catch(function() {
                this._readingTweets = false;
            }.bind(this));
        },
        getTweets: function(count, excludeReplies, maxId) {
            if (!count) count = TWITTER_QUANTITY_TWEETS_GET;
            if (!helpService.isBool(excludeReplies)) excludeReplies = true;
            return TwitterService.tweets({ count: count, max_id: maxId, exclude_replies: excludeReplies }).$promise;
        },
        getUser: function getUser() {
            return TwitterService.user().$promise;
        }
    }

}]);

var app = angular.module('app.directives');

app.directive('followersKnow', function followersKnow() {

    return {
        restrict : 'E',
        template : [
            '<div class="col-md-3 profile-photos">',
            '   <img class="profile-photos-img" src="images/followers-know.png" />',
            '</div>'
        ].join('')
    };

});
var app = angular.module('app.directives');

app.directive('profileFollowersKnow', function profileFollowersKnow() {

    return {
        restrict : 'E',
        scope: {},
        template : [
            '<section class="profile-photos-container">',
            '   <header class="profile-photos-header">',
            '       <span><i class="fa fa-user" aria-hidden="true"></i> {{ ctrl.followers.length }} Followers you know</span>',
            '   </header>',
            '   <section>',
            '       <followers-know ng-repeat="follow in ctrl.followers track by $index"></followers-know>',
            '   </section>',
            '</section>'
        ].join(''),
        controllerAs: 'ctrl',
        controller: ["helpService", function profileFollowersKnowController(helpService) {

            this.followers = new Array(helpService.random(16));

        }]
    };

});
var app = angular.module('app.directives');

app.directive('navbarIcon', function navbarIcon() {

    return {
        restrict : 'E',
        template : [
            '<i class="fa fa-2x fa-twitter navbar-icon" aria-hidden="true"></i>'
        ].join('')
    };

});
var app = angular.module('app.directives');

app.directive('navbarOption', function navbarOption() {

    return {
        restrict : 'E',
        replace: true,
        scope: {},
        template : [
            '<li>',
            '   <a href="#">',
            '       <span class="glyphicon glyphicon-home" aria-hidden="true"></span>',
            '       {{ title }}',
            '   </a>',
            '</li>'
        ].join(''),
        link: function link(scope, element, attrs) {
            scope.title = attrs.title;
        }
    };

});
var app = angular.module('app.directives');

app.directive('navbarSearch', function navbarSearch() {

    return {
        restrict : 'E',
        template : [
            '<form>',
            '   <input type="text" class="form-control mod-search" placeholder="Search Twitter" />',
            '</form>'
        ].join('')
    };

});
var app = angular.module('app.directives');

app.directive('profileCount', function profileCount() {

    return {
        restrict : 'E',
        scope: {
            count: '='
        },
        template : [
            '   <article class="profile-count">',
            '       <div class="row">',
            '           <span class="profile-count-title">{{ title }}</span>',
            '       </div>',
            '       <div class="row">',
            '           <span class="profile-count-data">{{ count }}</span>',
            '       </div>',
            '   </article>'
        ].join(''),
        link: function link(scope, element, attrs) {
            scope.title = attrs.title;
            if (attrs.active) element.find('article').addClass('mod-active');
        }
    };

});
var app = angular.module('app.directives');

app.directive('profileImg', ["$filter", function profileImg($filter) {

    return {
        restrict : 'E',
        scope: {
            link: '='
        },
        template : [
            '<img ng-src="{{ link }}" />'
        ].join(''),
        link: function link(scope, element, attrs) {

            element.find('img').addClass(attrs.classImg);

            var stopWatch = scope.$watch(function () {
                return scope.link;
            }, function () {
                if (!scope.link) return;
                if (attrs.removeText) scope.link = $filter('removeText')(scope.link, attrs.removeText);
                stopWatch();
            });

        }
    };

}]);
var app = angular.module('app.directives');

app.directive('profileTrends', function profileTrends() {

    return {
        restrict : 'E',
        template : [
            '<section class="profile-trends-container col-md-12">',
            '   <header class="profile-trends-container-header">',
            '       Trends',
            '   </header>',
            '   <section>',
            '       <trend hash="AngularJS" count="2,147"></trend>',
            '       <trend hash="React" count="4,303"></trend>',
            '       <trend hash="FelippeNaB2W" count="1,906"></trend>',
            '       <trend hash="B2WDigital" count="7,987"></trend>',
            '       <trend hash="FrontEndCarioca" count="208"></trend>',
            '       <trend hash="FrontInRio" count="243"></trend>',
            '       <trend hash="SubmarinoCom" count="86,456"></trend>',
            '       <trend hash="BlackFriday" count="347"></trend>',
            '       <trend hash="B2WInterview" count="9,651"></trend>',
            '       <trend hash="JavaScriptS2" count="234"></trend>',
            '   </section>',
            '</section>'
        ].join('')
    };

});
var app = angular.module('app.directives');

app.directive('trend', function trend() {

    return {
        restrict : 'E',
        scope: {},
        template : [
            '<div class="col-md-12 profile-trend">',
            '   <div class="row">',
            '       <span class="profile-trend-hashtag">{{ hash | hashtag }}</span>',
            '   </div>',
            '   <div class="row">',
            '       <span class="profile-trend-count">{{ count }} Tweets</span>',
            '   </div>',
            '</div>'
        ].join(''),
        link: function link(scope, element, attrs) {
            scope.hash = attrs.hash;
            scope.count = attrs.count;
        }
    };

});
var app = angular.module('app.directives');

app.directive('photosVideos', function photosVideos() {

    return {
        restrict : 'E',
        template : [
            '<div class="col-md-4 profile-photos">',
            '   <img class="profile-photos-img" src="images/photo-and-videos.jpg" />',
            '</div>'
        ].join('')
    };

});
var app = angular.module('app.directives');

app.directive('profilePhotosVideos', function profilePhotosVideos() {

    return {
        restrict : 'E',
        scope: {},
        template : [
            '<section class="profile-photos-container">',
            '   <header class="profile-photos-header">',
            '       <span><i class="fa fa-camera" aria-hidden="true"></i> {{ ctrl.photos.length }} photos and videos</span>',
            '   </header>',
            '   <section>',
            '       <photos-videos ng-repeat="photo in ctrl.photos track by $index"></photos-videos>',
            '   </section>',
            '</section>'
        ].join(''),
        controllerAs: 'ctrl',
        controller: ["helpService", function profilePhotosVideosController(helpService) {

            this.photos = new Array(helpService.random(9));

        }]
    };

});
var app = angular.module('app.directives');

app.directive('profileTweets', function profileTweets() {

    return {
        restrict : 'E',
        scope: {
            tweets: '=',
            tweetsHeaderOptions: '='
        },
        template : [
            '<section class="col-md-12 col-sm-12 col-xs-12 profile-tweets-container">',
            '   <header class="profile-tweets-header">',
            '       <tweets-header-option ng-repeat="headerOption in tweetsHeaderOptions" text="headerOption.text" active="headerOption.active" index="$index"></tweets-header-option>',
            '   </header>',
            '   <section>',
            '       <tweet ng-repeat="tweet in tweets track by $index" tweet="tweet"></tweet>',
            '   </section>',
            '   <div infinite-scroll="ctrl.moreTweets()" infinite-scroll-distance="0"></div>',
            '</section>'
        ].join(''),
        controller: ["$scope", function profileTweetsController($scope) {

            this.moreTweets = function moreTweets() {
                if (!$scope.tweets) return;
                $scope.$parent.ctrl.moreTweets();
            };

            this.selectTweetsHeaderOption = function selectTweetsHeaderOption(index) {
                $scope.$parent.ctrl.selectHeaderOptionsActive(index);
            };

        }],
        controllerAs: 'ctrl'

    };

});
var app = angular.module('app.directives');

app.directive('tweetsHeaderOption', function tweetsHeaderOption() {

    return {
        restrict : 'E',
        scope: {
            active: '=',
            text: '=',
            index: '='
        },
        template : [
            '<section class="profile-tweets-option" ng-class="{ \'mod-active\' : active }" ng-click="ctrl.selectHeaderOption()">',
            '   <span>{{ text }}</span>',
            '</section>'
        ].join(''),
        controller: ["$scope", function tweetsHeaderOptionController($scope) {

            this.selectHeaderOption = function selectHeaderOption() {
                $scope.$parent.ctrl.selectTweetsHeaderOption($scope.index);
            };

        }],
        controllerAs: 'ctrl'
    };

});
var app = angular.module('app.directives');

app.directive('profileInfoIcon', function profileInfoIcon() {

    return {
        restrict : 'E',
        scope: {
            text: '='
        },
        template : [
            '<div class="row profile-info-name profile-info-data">',
            '   <i class="fa" ng-class="icon" aria-hidden="true"></i>',
            '   <span>{{ text }}</span>',
            '</div>'
        ].join(''),
        link: function link(scope, element, attrs) {
            scope.icon = attrs.icon;
            if (attrs.isLink) element.find('span').addClass('profile-info-description-url');
        }
    };

});

var app = angular.module('app.directives');

app.directive('profileInfo', function profileInfo() {

    return {
        restrict : 'E',
        priority: 1,
        scope: {
            user: '='
        },
        template : [
            '<section class="profile-info-container">',
            '   <article>',
            '       <div class="row profile-info-name">',
            '           <span class="profile-info-name-title">{{ user.name }}</span>',
            '       </div>',
            '       <div class="row profile-info-name">',
            '           <span class="profile-info-name-at">{{ user.screen_name | screenName }}</span>',
            '       </div>',
            '   </article>',
            '   <article class="profile-info-description-container">',
            '       <div class="row profile-info-name">',
            '           <span>{{ user.description }}</span>',
            '       </div>',
            '   </article>',
            '   <article class="profile-info-description-container">',
            '       <profile-info-icon icon="fa-map-marker" text="user.location"></profile-info-icon>',
            '       <profile-info-icon icon="fa-link" text="user.name" is-link="true"></profile-info-icon>',
            '       <profile-info-icon icon="fa-calendar" text="user.created_at"></profile-info-icon>',
            '   </article>',
            '   <article class="profile-info-description-container">',
            '       <button class="btn btn-tweet btn-full">',
            '           <i class="fa fa-pencil-square-o" aria-hidden="true"></i>',
            '           <span>Tweet to {{ user.name }}</span>',
            '       </button>',
            '   </article>',
            '</section>'
        ].join('')
    };

});
var app = angular.module('app.directives');

app.directive('tweetIcon', function tweetIcon() {

    return {
        restrict : 'E',
        scope: {
            value: '='
        },
        template : [
            '<i class="fa" ng-class="icon" aria-hidden="true">',
            '   <span class="tweet-main-icons-value" ng-if="value">{{ value }}</span>',
            '</i>'
        ].join(''),
        link: function link(scope, element, attrs) {
            scope.icon = attrs.icon;
        }
    };

});
var app = angular.module('app.directives');

app.directive('tweetImage', ["flickr", "helpService", function tweetImage(flickr, helpService) {

    return {
        restrict : 'E',
        scope: {
            tweet: '='
        },
        template : [
            '<div class="row" ng-if="url">',
            '   <img class="profile-tweet-image" ng-src="{{ url }}" />',
            '</div>'
        ].join(''),
        link: function link(scope) {

            if (scope.tweet.entities.hashtags.length) {
                var tag = helpService.first(scope.tweet.entities.hashtags).text;
                flickr.getPhotos(tag).then(function (response) {
                    scope.url = flickr.getPhotoUrl(helpService.first(response.photos.photo));
                });
            } else if (scope.tweet.entities.media && scope.tweet.entities.media.length) {
                scope.url = helpService.first(scope.tweet.entities.media).media_url;
            }

        }
    };

}]);
var app = angular.module('app.directives');

app.directive('tweet', function tweet() {

    return {
        restrict : 'E',
        scope: {
            tweet: '='
        },
        template : [
            '<article class="tweet-container col-md-12 col-sm-12 col-xs-12">',
            '   <aside class="col-md-2 col-sm-2 tweet-img-container hidden-xs">',
            '       <img class="tweet-img" ng-src="{{ tweet.user.profile_image_url }}" />',
            '   </aside>',
            '   <main class="col-md-10 col-sm-10 col-xs-10 tweet-main-container">',
            '       <div class="row tweet-main-reply" ng-if="tweet.entities.user_mentions.length">',
            '           <span><i class="fa fa-reply hidden-xs icon-reply" aria-hidden="true"></i>In reply to {{ tweet.entities.user_mentions[0].name }}</span>',
            '       </div>',
            '       <div class="row tweet-main-profile-container">',
            '           <span class="tweet-main-profile-name">{{ tweet.user.name }}</span>',
            '           <span class="tweet-main-profile-at">{{ tweet.user.screen_name | screenName }}</span>',
            '       </div>',
            '       <div class="row tweet-main">',
            '           <span>{{ tweet.text }}</span>',
            '       </div>',
            '       <tweet-image tweet="tweet"></tweet-image>',
            '       <div class="row tweet-main-icons">',
            '           <tweet-icon icon="fa-reply" value="tweet.entities.user_mentions.length"></tweet-icon>',
            '           <tweet-icon icon="fa-retweet" value="tweet.retweet_count"></tweet-icon>',
            '           <tweet-icon icon="fa-heart" value="tweet.favorite_count"></tweet-icon>',
            '           <tweet-icon icon="fa-ellipsis-h"></tweet-icon>',
            '       </div>',
            '   </main>',
            '</article>'
        ].join('')
    };

});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9hcHAuanMiLCIvY29uc3RhbnRzL2ZsaWNrci5qcyIsIi9jb25zdGFudHMvdHdpdHRlci5qcyIsIi9maWx0ZXIvaGFzaHRhZy5qcyIsIi9maWx0ZXIvcmVtb3ZlLXRleHQuanMiLCIvZmlsdGVyL3NjcmVlbi1uYW1lLmpzIiwiL2NvbnRyb2xsZXIvcHJvZmlsZS1kZXRhaWxzLmpzIiwiL3NlcnZpY2VzL2ZsaWNrci5qcyIsIi9zZXJ2aWNlcy9oZWxwLmpzIiwiL3NlcnZpY2VzL3R3aXR0ZXIuanMiLCIvZGlyZWN0aXZlcy9mb2xsb3dlcnMta25vdy9mb2xsb3dlcnMta25vdy5qcyIsIi9kaXJlY3RpdmVzL2ZvbGxvd2Vycy1rbm93L3Byb2ZpbGUtZm9sbG93ZXJzLWtub3cuanMiLCIvZGlyZWN0aXZlcy9uYXZiYXIvbmF2YmFyLWljb24uanMiLCIvZGlyZWN0aXZlcy9uYXZiYXIvbmF2YmFyLW9wdGlvbi5qcyIsIi9kaXJlY3RpdmVzL25hdmJhci9uYXZiYXItc2VhcmNoLmpzIiwiL2RpcmVjdGl2ZXMvcHJvZmlsZS9wcm9maWxlLWNvdW50LmpzIiwiL2RpcmVjdGl2ZXMvcHJvZmlsZS9wcm9maWxlLWltZy5qcyIsIi9kaXJlY3RpdmVzL3RyZW5kcy9wcm9maWxlLXRyZW5kcy5qcyIsIi9kaXJlY3RpdmVzL3RyZW5kcy90cmVuZC5qcyIsIi9kaXJlY3RpdmVzL3Bob3Rvcy12aWRlb3MvcGhvdG9zLXZpZGVvcy5qcyIsIi9kaXJlY3RpdmVzL3Bob3Rvcy12aWRlb3MvcHJvZmlsZS1waG90b3MtdmlkZW9zLmpzIiwiL2RpcmVjdGl2ZXMvdHdlZXRzL3Byb2ZpbGUtdHdlZXRzLmpzIiwiL2RpcmVjdGl2ZXMvdHdlZXRzL3R3ZWV0cy1oZWFkZXItb3B0aW9uLmpzIiwiL2RpcmVjdGl2ZXMvcHJvZmlsZS9pbmZvL3Byb2ZpbGUtaW5mby1pY29uLmpzIiwiL2RpcmVjdGl2ZXMvcHJvZmlsZS9pbmZvL3Byb2ZpbGUtaW5mby5qcyIsIi9kaXJlY3RpdmVzL3R3ZWV0cy90d2VldC90d2VldC1pY29uLmpzIiwiL2RpcmVjdGl2ZXMvdHdlZXRzL3R3ZWV0L3R3ZWV0LWltYWdlLmpzIiwiL2RpcmVjdGl2ZXMvdHdlZXRzL3R3ZWV0L3R3ZWV0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFFBQUEsT0FBQSxlQUFBO0FBQ0EsUUFBQSxPQUFBLGFBQUE7QUFDQSxRQUFBLE9BQUEsaUJBQUE7QUFDQSxRQUFBLE9BQUEsa0JBQUEsQ0FBQSxtQkFBQTtBQUNBLFFBQUEsT0FBQSxnQkFBQSxDQUFBLGlCQUFBOztBQUVBLElBQUEsTUFBQSxRQUFBLE9BQUEsT0FBQSxDQUFBLGdCQUFBLGtCQUFBLGFBQUEsZUFBQTs7QUFFQSxJQUFBLDBCQUFBLFNBQUEsZ0JBQUE7SUFDQSxlQUFBLEtBQUEsS0FBQSxFQUFBLGNBQUE7Ozs7QUNQQSxJQUFBO0FBQ0EsWUFBQSxRQUFBLE9BQUE7O0FBRUEsVUFBQSxTQUFBLGNBQUE7O0FBRUEsVUFBQSxTQUFBLGNBQUE7Ozs7QUNMQSxJQUFBO0FBQ0EsWUFBQSxRQUFBLE9BQUE7O0FBRUEsVUFBQSxTQUFBLGVBQUE7O0FBRUEsVUFBQSxTQUFBLCtCQUFBOztBQ1BBLElBQUEsVUFBQSxRQUFBLE9BQUE7O0FBRUEsUUFBQSxPQUFBLFdBQUEsV0FBQTtJQUNBLE9BQUEsVUFBQSxNQUFBO1FBQ0EsT0FBQSxPQUFBLE1BQUEsT0FBQTs7O0FDSkEsSUFBQSxVQUFBLFFBQUEsT0FBQTs7QUFFQSxRQUFBLE9BQUEsY0FBQSxXQUFBO0lBQ0EsT0FBQSxVQUFBLE1BQUEsUUFBQTtRQUNBLE9BQUEsT0FBQSxLQUFBLFFBQUEsUUFBQSxNQUFBOzs7QUNKQSxJQUFBLFVBQUEsUUFBQSxPQUFBOztBQUVBLFFBQUEsT0FBQSxjQUFBLFdBQUE7SUFDQSxPQUFBLFVBQUEsZ0JBQUE7UUFDQSxPQUFBLGlCQUFBLE1BQUEsaUJBQUE7OztBQ0pBLElBQUEsTUFBQSxRQUFBLE9BQUE7O0FBRUEsSUFBQSxXQUFBLDZEQUFBLFNBQUEseUJBQUEsSUFBQSxhQUFBLFNB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QkFBQSxTQUFBLFdBQUEsU0FBQTs7SUFFQSxPQUFBO1FBQ0EsV0FBQTtRQUNBLE9BQUE7WUFDQSxNQUFBOztRQUVBLFdBQUE7WUFDQTtVQUNBLEtBQUE7UUFDQSxNQUFBLFNBQUEsS0FBQSxPQUFBLFNBQUEsT0FBQTs7WUFFQSxRQUFBLEtBQUEsT0FBQSxTQUFBLE1BQUE7O1lBRUEsSUFBQSxZQUFBLE1BQUEsT0FBQSxZQUFBO2dCQUNBLE9BQUEsTUFBQTtlQUNBLFlBQUE7Z0JBQ0EsSUFBQSxDQUFBLE1BQUEsTUFBQTtnQkFDQSxJQUFBLE1BQUEsWUFBQSxNQUFBLE9BQUEsUUFBQSxjQUFBLE1BQUEsTUFBQSxNQUFBO2dCQUNBOzs7Ozs7O0FDckJBLElBQUEsTUFBQSxRQUFBLE9BQUE7O0FBRUEsSUFBQSxVQUFBLGlCQUFBLFNBQUEsZ0JBQUE7O0lBRUEsT0FBQTtRQUNBLFdBQUE7UUFDQSxXQUFBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtVQUNBLEtBQUE7Ozs7QUN4QkEsSUFBQSxNQUFBLFFBQUEsT0FBQTs7QUFFQSxJQUFBLFVBQUEsU0FBQSxTQUFBLFFBQUE7O0lBRUEsT0FBQTtRQUNBLFdBQUE7UUFDQSxPQUFBO1FBQ0EsV0FBQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7VUFDQSxLQUFBO1FBQ0EsTUFBQSxTQUFBLEtBQUEsT0FBQSxTQUFBLE9BQUE7WUFDQSxNQUFBLE9BQUEsTUFBQTtZQUNBLE1BQUEsUUFBQSxNQUFBOzs7OztBQ25CQSxJQUFBLE1BQUEsUUFBQSxPQUFBOztBQUVBLElBQUEsVUFBQSxnQkFBQSxTQUFBLGVBQUE7O0lBRUEsT0FBQTtRQUNBLFdBQUE7UUFDQSxXQUFBO1lBQ0E7WUFDQTtZQUNBO1VBQ0EsS0FBQTs7OztBQ1ZBLElBQUEsTUFBQSxRQUFBLE9BQUE7O0FBRUEsSUFBQSxVQUFBLHVCQUFBLFNBQUEsc0JBQUE7O0lBRUEsT0FBQTtRQUNBLFdBQUE7UUFDQSxPQUFBO1FBQ0EsV0FBQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7VUFDQSxLQUFBO1FBQ0EsY0FBQTtRQUNBLDRCQUFBLFNBQUEsOEJBQUEsYUFBQTs7WUFFQSxLQUFBLFNBQUEsSUFBQSxNQUFBLFlBQUEsT0FBQTs7Ozs7O0FDcEJBLElBQUEsTUFBQSxRQUFBLE9BQUE7O0FBRUEsSUFBQSxVQUFBLGlCQUFBLFNBQUEsZ0JBQUE7O0lBRUEsT0FBQTtRQUNBLFdBQUE7UUFDQSxPQUFBO1lBQ0EsUUFBQTtZQUNBLHFCQUFBOztRQUVBLFdBQUE7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7VUFDQSxLQUFBO1FBQ0EsdUJBQUEsU0FBQSx3QkFBQSxRQUFBOztZQUVBLEtBQUEsYUFBQSxTQUFBLGFBQUE7Z0JBQ0EsSUFBQSxDQUFBLE9BQUEsUUFBQTtnQkFDQSxPQUFBLFFBQUEsS0FBQTs7O1lBR0EsS0FBQSwyQkFBQSxTQUFBLHlCQUFBLE9BQUE7Z0JBQ0EsT0FBQSxRQUFBLEtBQUEsMEJBQUE7Ozs7UUFJQSxjQUFBOzs7OztBQ2pDQSxJQUFBLE1BQUEsUUFBQSxPQUFBOztBQUVBLElBQUEsVUFBQSxzQkFBQSxTQUFBLHFCQUFBOztJQUVBLE9BQUE7UUFDQSxXQUFBO1FBQ0EsT0FBQTtZQUNBLFFBQUE7WUFDQSxNQUFBO1lBQ0EsT0FBQTs7UUFFQSxXQUFBO1lBQ0E7WUFDQTtZQUNBO1VBQ0EsS0FBQTtRQUNBLHVCQUFBLFNBQUEsNkJBQUEsUUFBQTs7WUFFQSxLQUFBLHFCQUFBLFNBQUEscUJBQUE7Z0JBQ0EsT0FBQSxRQUFBLEtBQUEseUJBQUEsT0FBQTs7OztRQUlBLGNBQUE7Ozs7QUN2QkEsSUFBQSxNQUFBLFFBQUEsT0FBQTs7QUFFQSxJQUFBLFVBQUEsbUJBQUEsU0FBQSxrQkFBQTs7SUFFQSxPQUFBO1FBQ0EsV0FBQTtRQUNBLE9BQUE7WUFDQSxNQUFBOztRQUVBLFdBQUE7WUFDQTtZQUNBO1lBQ0E7WUFDQTtVQUNBLEtBQUE7UUFDQSxNQUFBLFNBQUEsS0FBQSxPQUFBLFNBQUEsT0FBQTtZQUNBLE1BQUEsT0FBQSxNQUFBO1lBQ0EsSUFBQSxNQUFBLFFBQUEsUUFBQSxLQUFBLFFBQUEsU0FBQTs7Ozs7O0FDakJBLElBQUEsTUFBQSxRQUFBLE9BQUE7O0FBRUEsSUFBQSxVQUFBLGVBQUEsU0FBQSxjQUFBOztJQUVBLE9BQUE7UUFDQSxXQUFBO1FBQ0EsVUFBQTtRQUNBLE9BQUE7WUFDQSxNQUFBOztRQUVBLFdBQUE7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1VBQ0EsS0FBQTs7OztBQ3JDQSxJQUFBLE1BQUEsUUFBQSxPQUFBOztBQUVBLElBQUEsVUFBQSxhQUFBLFNBQUEsWUFBQTs7SUFFQSxPQUFBO1FBQ0EsV0FBQTtRQUNBLE9BQUE7WUFDQSxPQUFBOztRQUVBLFdBQUE7WUFDQTtZQUNBO1lBQ0E7VUFDQSxLQUFBO1FBQ0EsTUFBQSxTQUFBLEtBQUEsT0FBQSxTQUFBLE9BQUE7WUFDQSxNQUFBLE9BQUEsTUFBQTs7Ozs7QUNmQSxJQUFBLE1BQUEsUUFBQSxPQUFBOztBQUVBLElBQUEsVUFBQSx3Q0FBQSxTQUFBLFdBQUEsUUFBQSxhQUFBOztJQUVBLE9BQUE7UUFDQSxXQUFBO1FBQ0EsT0FBQTtZQUNBLE9BQUE7O1FBRUEsV0FBQTtZQUNBO1lBQ0E7WUFDQTtVQUNBLEtBQUE7UUFDQSxNQUFBLFNBQUEsS0FBQSxPQUFBOztZQUVBLElBQUEsTUFBQSxNQUFBLFNBQUEsU0FBQSxRQUFBO2dCQUNBLElBQUEsTUFBQSxZQUFBLE1BQUEsTUFBQSxNQUFBLFNBQUEsVUFBQTtnQkFDQSxPQUFBLFVBQUEsS0FBQSxLQUFBLFVBQUEsVUFBQTtvQkFDQSxNQUFBLE1BQUEsT0FBQSxZQUFBLFlBQUEsTUFBQSxTQUFBLE9BQUE7O21CQUVBLElBQUEsTUFBQSxNQUFBLFNBQUEsU0FBQSxNQUFBLE1BQUEsU0FBQSxNQUFBLFFBQUE7Z0JBQ0EsTUFBQSxNQUFBLFlBQUEsTUFBQSxNQUFBLE1BQUEsU0FBQSxPQUFBOzs7Ozs7O0FDdEJBLElBQUEsTUFBQSxRQUFBLE9BQUE7O0FBRUEsSUFBQSxVQUFBLFNBQUEsU0FBQSxRQUFBOztJQUVBLE9BQUE7UUFDQSxXQUFBO1FBQ0EsT0FBQTtZQUNBLE9BQUE7O1FBRUEsV0FBQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7WUFDQTtVQUNBLEtBQUE7OztHQUdBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnYXBwLmZpbHRlcnMnLCBbXSk7XG5hbmd1bGFyLm1vZHVsZSgnYXBwLnZpZXdzJywgW10pO1xuYW5ndWxhci5tb2R1bGUoJ2FwcC5jb25zdGFudHMnLCBbXSk7XG5hbmd1bGFyLm1vZHVsZSgnYXBwLmRpcmVjdGl2ZXMnLCBbJ2luZmluaXRlLXNjcm9sbCcsICdhcHAuZmlsdGVycyddKTtcbmFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZXMnLCBbJ2FwcC5jb25zdGFudHMnLCAnbmdSZXNvdXJjZSddKTtcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ2FwcC5zZXJ2aWNlcycsICdhcHAuZGlyZWN0aXZlcycsICdhcHAudmlld3MnLCAnYXBwLmZpbHRlcnMnLCAnbmdSb3V0ZSddKTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlcikge1xuICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLCB7IHRlbXBsYXRlVXJsIDogJ3Byb2ZpbGUtZGV0YWlscy5odG1sJyB9KTtcbn0pOyIsIi8qIGdsb2JhbHMgYW5ndWxhcjpmYWxzZSAqL1xuXG52YXIgY29uc3RhbnRzO1xuY29uc3RhbnRzID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5jb25zdGFudHMnKTtcblxuY29uc3RhbnRzLmNvbnN0YW50KCdGTElDS1JfQVBJJywgJ2h0dHBzOi8vYXBpLmZsaWNrci5jb20vc2VydmljZXMvcmVzdC8nKTtcblxuY29uc3RhbnRzLmNvbnN0YW50KCdGTElDS1JfS0VZJywgJzYxZTE2ZThhMDY1NjY3NjI1NzVjYWZkZjVmMTY1Yjc5Jyk7XG4iLCIvKiBnbG9iYWxzIGFuZ3VsYXI6ZmFsc2UgKi9cblxudmFyIGNvbnN0YW50cztcbmNvbnN0YW50cyA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuY29uc3RhbnRzJyk7XG5cbmNvbnN0YW50cy5jb25zdGFudCgnVFdJVFRFUl9BUEknLCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJyk7XG5cbmNvbnN0YW50cy5jb25zdGFudCgnVFdJVFRFUl9RVUFOVElUWV9UV0VFVFNfR0VUJywgMjAwKTtcbiIsInZhciBmaWx0ZXJzID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5maWx0ZXJzJyk7XG5cbmZpbHRlcnMuZmlsdGVyKCdoYXNodGFnJywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChoYXNoKSB7XG4gICAgICAgIHJldHVybiBoYXNoID8gJyMnICsgaGFzaCA6ICcnO1xuICAgIH07XG59KTsiLCJ2YXIgZmlsdGVycyA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuZmlsdGVycycpO1xuXG5maWx0ZXJzLmZpbHRlcigncmVtb3ZlVGV4dCcsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGV4dCwgcmVtb3ZlKSB7XG4gICAgICAgIHJldHVybiB0ZXh0ID8gdGV4dC5yZXBsYWNlKHJlbW92ZSwgJycpIDogJyc7XG4gICAgfTtcbn0pOyIsInZhciBmaWx0ZXJzID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5maWx0ZXJzJyk7XG5cbmZpbHRlcnMuZmlsdGVyKCdzY3JlZW5OYW1lJywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICh1c2VyU2NyZWVuTmFtZSkge1xuICAgICAgICByZXR1cm4gdXNlclNjcmVlbk5hbWUgPyAnQCcgKyB1c2VyU2NyZWVuTmFtZSA6ICcnO1xuICAgIH07XG59KTsiLCJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJyk7XG5cbmFwcC5jb250cm9sbGVyKCdwcm9maWxlRGV0YWlsc0NvbnRyb2xsZXInLCBmdW5jdGlvbiBwcm9maWxlRGV0YWlsc0NvbnRyb2xsZXIoJHEsIGhlbHBTZXJ2aWNlLCB0d2l0dGVyKSB7XG5cbiAgICAkcS5hbGwoW3R3aXR0ZXIuZ2V0VHdlZXRzKCksIHR3aXR0ZXIuZ2V0VXNlcigpXSkudGhlbihoZWxwU2VydmljZS5zcHJlYWQoZnVuY3Rpb24gKHR3ZWV0cywgdXNlcikge1xuICAgICAgICB0aGlzLnR3ZWV0cyA9IHR3ZWV0cztcbiAgICAgICAgdGhpcy51c2VyID0gdXNlcjtcbiAgICB9LmJpbmQodGhpcykpKTtcblxuICAgIHRoaXMudHdlZXRzSGVhZGVyT3B0aW9ucyA9IFtcbiAgICAgICAgeyB0ZXh0OiAnVHdlZXRzJywgYWN0aXZlOiB0cnVlLCBleGNsdWRlX3JlcGxpZXM6IHRydWUsIG9ubHlfbWVkaWE6IGZhbHNlIH0sXG4gICAgICAgIHsgdGV4dDogJ1R3ZWV0cyAmIHJlcGxpZXMnLCBhY3RpdmU6IGZhbHNlLCBleGNsdWRlX3JlcGxpZXM6IGZhbHNlLCBvbmx5X21lZGlhOiBmYWxzZSB9LFxuICAgICAgICB7IHRleHQ6ICdNZWRpYScsIGFjdGl2ZTogZmFsc2UsIGV4Y2x1ZGVfcmVwbGllczogZmFsc2UsIG9ubHlfbWVkaWE6IHRydWUgfVxuICAgIF07XG5cbiAgICB0aGlzLm1vcmVUd2VldHMgPSBmdW5jdGlvbiBtb3JlVHdlZXRzKCkge1xuICAgICAgICB2YXIgb3B0aW9uID0gaGVscFNlcnZpY2UuZmluZCh0aGlzLnR3ZWV0c0hlYWRlck9wdGlvbnMsIGZ1bmN0aW9uIChvcHRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBvcHRpb24uYWN0aXZlO1xuICAgICAgICB9KTtcbiAgICAgICAgdHdpdHRlci5tb3JlVHdlZXRzKHRoaXMudHdlZXRzLCBvcHRpb24uZXhjbHVkZV9yZXBsaWVzLCBvcHRpb24ub25seV9tZWRpYSk7XG4gICAgfTtcblxuICAgIHRoaXMuc2VsZWN0SGVhZGVyT3B0aW9uc0FjdGl2ZSA9IGZ1bmN0aW9uIHNlbGVjdEhlYWRlck9wdGlvbnNBY3RpdmUoaW5kZXhTZWxlY3RlZCkge1xuICAgICAgICBoZWxwU2VydmljZS5mb3JFYWNoKHRoaXMudHdlZXRzSGVhZGVyT3B0aW9ucywgZnVuY3Rpb24gKG9wdGlvbiwgaW5kZXgpIHtcbiAgICAgICAgICAgIG9wdGlvbi5hY3RpdmUgPSBpbmRleCA9PT0gaW5kZXhTZWxlY3RlZDtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudHdlZXRzID0gW107XG4gICAgICAgIHRoaXMubW9yZVR3ZWV0cygpO1xuICAgIH07XG5cblxuXG59KTsiLCIvKiBnbG9iYWxzIGFuZ3VsYXI6ZmFsc2UgKi9cblxudmFyIHNlcnZpY2VzO1xuc2VydmljZXMgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2VzJyk7XG5cbnNlcnZpY2VzLmZhY3RvcnkoJ0ZsaWNrclNlcnZpY2UnLCBmdW5jdGlvbiBGbGlja3JTZXJ2aWNlKCRyZXNvdXJjZSwgRkxJQ0tSX0FQSSwgRkxJQ0tSX0tFWSkge1xuICAgIHJldHVybiAkcmVzb3VyY2UoRkxJQ0tSX0FQSSwge30sIHtcbiAgICAgICAgcGhvdG9zOiB7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiBGTElDS1JfQVBJLFxuICAgICAgICAgICAgaXNBcnJheTogZmFsc2UsXG4gICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdmbGlja3IucGhvdG9zLnNlYXJjaCcsXG4gICAgICAgICAgICAgICAgYXBpX2tleTogRkxJQ0tSX0tFWSxcbiAgICAgICAgICAgICAgICBwYWdlOiAxLFxuICAgICAgICAgICAgICAgIGZvcm1hdDogJ2pzb24nLFxuICAgICAgICAgICAgICAgIG5vanNvbmNhbGxiYWNrOiAxLFxuICAgICAgICAgICAgICAgIHBlcl9wYWdlOiAxXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn0pO1xuXG5zZXJ2aWNlcy5mYWN0b3J5KCdmbGlja3InLCBmdW5jdGlvbiBmbGlja3IoRmxpY2tyU2VydmljZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGdldFBob3RvczogZnVuY3Rpb24gZ2V0UGhvdG9zKHRhZ3MpIHtcbiAgICAgICAgICAgIHJldHVybiBGbGlja3JTZXJ2aWNlLnBob3Rvcyh7IHRhZ3M6IHRhZ3MgfSkuJHByb21pc2U7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFBob3RvVXJsOiBmdW5jdGlvbiBnZXRQaG90b1VybChwaG90bykge1xuICAgICAgICAgICAgcmV0dXJuICdodHRwczovL2Zhcm0nICsgcGhvdG8uZmFybSArICcuc3RhdGljZmxpY2tyLmNvbS8nICsgcGhvdG8uc2VydmVyICsgJy8nICsgcGhvdG8uaWQgKyAnXycgKyBwaG90by5zZWNyZXQgKyAnLmpwZyc7XG4gICAgICAgIH1cbiAgICB9XG59KTsiLCJ2YXIgc2VydmljZXM7XG5zZXJ2aWNlcyA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZXMnKTtcblxuc2VydmljZXMuZmFjdG9yeSgnaGVscFNlcnZpY2UnLCBmdW5jdGlvbiBoZWxwU2VydmljZSgpIHtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGZpcnN0OiBmdW5jdGlvbiBmaXJzdChjb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gY29sbGVjdGlvblswXTtcbiAgICAgICAgfSxcbiAgICAgICAgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChjb2xsZWN0aW9uLCBmbikge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNFbXB0eShjb2xsZWN0aW9uKSkgcmV0dXJuO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2xsZWN0aW9uLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgZm4oY29sbGVjdGlvbltpXSwgaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZpbmQ6IGZ1bmN0aW9uIGZpbmQoY29sbGVjdGlvbiwgZm4pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzRW1wdHkoY29sbGVjdGlvbikpIHJldHVybjtcbiAgICAgICAgICAgIHZhciByZXN1bHQ7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbGxlY3Rpb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoZm4oY29sbGVjdGlvbltpXSwgaSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY29sbGVjdGlvbltpXTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSxcbiAgICAgICAgaXNCb29sOiBmdW5jdGlvbiBpc0Jvb2wodmFyaWFibGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YodmFyaWFibGUpID09PSAnYm9vbGVhbic7XG4gICAgICAgIH0sXG4gICAgICAgIGlzRW1wdHk6IGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gKGNvbGxlY3Rpb24gJiYgY29sbGVjdGlvbi5sZW5ndGggPT09IDApIHx8IHR5cGVvZiBjb2xsZWN0aW9uID09PSAndW5kZWZpbmVkJztcbiAgICAgICAgfSxcbiAgICAgICAgbGFzdDogZnVuY3Rpb24gbGFzdChjb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gY29sbGVjdGlvbltjb2xsZWN0aW9uLmxlbmd0aCAtIDFdO1xuICAgICAgICB9LFxuICAgICAgICByYW5kb206IGZ1bmN0aW9uIHJhbWRvbShsaW1NYXgpIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKChNYXRoLnJhbmRvbSgpICogbGltTWF4KSArIDEpO1xuICAgICAgICB9LFxuICAgICAgICBzcHJlYWQ6IGZ1bmN0aW9uIHNwcmVhZChmdW5jKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYXJyYXkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcnJheSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuXG59KTsiLCIvKiBnbG9iYWxzIGFuZ3VsYXI6ZmFsc2UgKi9cblxudmFyIHNlcnZpY2VzO1xuc2VydmljZXMgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2VzJyk7XG5cbnNlcnZpY2VzLmZhY3RvcnkoJ1R3aXR0ZXJTZXJ2aWNlJywgZnVuY3Rpb24gVHdpdHRlclNlcnZpY2UoJHJlc291cmNlLCBUV0lUVEVSX0FQSSkge1xuICAgIHJldHVybiAkcmVzb3VyY2UoVFdJVFRFUl9BUEksIHt9LCB7XG4gICAgICAgIHR3ZWV0czoge1xuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgIHVybDogVFdJVFRFUl9BUEkgKyAnL3R3ZWV0cycsXG4gICAgICAgICAgICBpc0FycmF5OiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICB1cmw6IFRXSVRURVJfQVBJICsgJy91c2VyJyxcbiAgICAgICAgICAgIGlzQXJyYXk6IGZhbHNlXG4gICAgICAgIH1cbiAgICB9KTtcbn0pO1xuXG5zZXJ2aWNlcy5mYWN0b3J5KCd0d2l0dGVyJywgZnVuY3Rpb24gdHdpdHRlcihoZWxwU2VydmljZSwgVHdpdHRlclNlcnZpY2UsIFRXSVRURVJfUVVBTlRJVFlfVFdFRVRTX0dFVCkge1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICAgIF9yZWFkaW5nVHdlZXRzOiBmYWxzZSxcbiAgICAgICAgbW9yZVR3ZWV0czogZnVuY3Rpb24gbW9yZVR3ZWV0cyhhcnJheVR3ZWV0cywgZXhjbHVkZVJlcGxpZXMsIG9ubHlNZWRpYSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX3JlYWRpbmdUd2VldHMpIHJldHVybjtcbiAgICAgICAgICAgIHZhciBtYXhfaWQgPSBhcnJheVR3ZWV0cy5sZW5ndGggPyAoaGVscFNlcnZpY2UubGFzdChhcnJheVR3ZWV0cykpLmlkX3N0ciA6IG51bGw7XG4gICAgICAgICAgICB0aGlzLl9yZWFkaW5nVHdlZXRzID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZ2V0VHdlZXRzKFRXSVRURVJfUVVBTlRJVFlfVFdFRVRTX0dFVCArIDEsIGV4Y2x1ZGVSZXBsaWVzLCBtYXhfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXJyYXlUd2VldHMubGVuZ3RoKSByZXNwb25zZS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIGhlbHBTZXJ2aWNlLmZvckVhY2gocmVzcG9uc2UsIGZ1bmN0aW9uKHR3ZWV0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvbmx5TWVkaWEgJiYgaGVscFNlcnZpY2UuaXNFbXB0eSh0d2VldC5lbnRpdGllcy5oYXNodGFncykgJiYgaGVscFNlcnZpY2UuaXNFbXB0eSh0d2VldC5lbnRpdGllcy5tZWRpYSkpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgYXJyYXlUd2VldHMucHVzaCh0d2VldCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVhZGluZ1R3ZWV0cyA9IGZhbHNlO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKS5jYXRjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZWFkaW5nVHdlZXRzID0gZmFsc2U7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRUd2VldHM6IGZ1bmN0aW9uKGNvdW50LCBleGNsdWRlUmVwbGllcywgbWF4SWQpIHtcbiAgICAgICAgICAgIGlmICghY291bnQpIGNvdW50ID0gVFdJVFRFUl9RVUFOVElUWV9UV0VFVFNfR0VUO1xuICAgICAgICAgICAgaWYgKCFoZWxwU2VydmljZS5pc0Jvb2woZXhjbHVkZVJlcGxpZXMpKSBleGNsdWRlUmVwbGllcyA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gVHdpdHRlclNlcnZpY2UudHdlZXRzKHsgY291bnQ6IGNvdW50LCBtYXhfaWQ6IG1heElkLCBleGNsdWRlX3JlcGxpZXM6IGV4Y2x1ZGVSZXBsaWVzIH0pLiRwcm9taXNlO1xuICAgICAgICB9LFxuICAgICAgICBnZXRVc2VyOiBmdW5jdGlvbiBnZXRVc2VyKCkge1xuICAgICAgICAgICAgcmV0dXJuIFR3aXR0ZXJTZXJ2aWNlLnVzZXIoKS4kcHJvbWlzZTtcbiAgICAgICAgfVxuICAgIH1cblxufSk7XG4iLCJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJyk7XG5cbmFwcC5kaXJlY3RpdmUoJ2ZvbGxvd2Vyc0tub3cnLCBmdW5jdGlvbiBmb2xsb3dlcnNLbm93KCkge1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3QgOiAnRScsXG4gICAgICAgIHRlbXBsYXRlIDogW1xuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJjb2wtbWQtMyBwcm9maWxlLXBob3Rvc1wiPicsXG4gICAgICAgICAgICAnICAgPGltZyBjbGFzcz1cInByb2ZpbGUtcGhvdG9zLWltZ1wiIHNyYz1cImltYWdlcy9mb2xsb3dlcnMta25vdy5wbmdcIiAvPicsXG4gICAgICAgICAgICAnPC9kaXY+J1xuICAgICAgICBdLmpvaW4oJycpXG4gICAgfTtcblxufSk7IiwidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycpO1xuXG5hcHAuZGlyZWN0aXZlKCdwcm9maWxlRm9sbG93ZXJzS25vdycsIGZ1bmN0aW9uIHByb2ZpbGVGb2xsb3dlcnNLbm93KCkge1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3QgOiAnRScsXG4gICAgICAgIHNjb3BlOiB7fSxcbiAgICAgICAgdGVtcGxhdGUgOiBbXG4gICAgICAgICAgICAnPHNlY3Rpb24gY2xhc3M9XCJwcm9maWxlLXBob3Rvcy1jb250YWluZXJcIj4nLFxuICAgICAgICAgICAgJyAgIDxoZWFkZXIgY2xhc3M9XCJwcm9maWxlLXBob3Rvcy1oZWFkZXJcIj4nLFxuICAgICAgICAgICAgJyAgICAgICA8c3Bhbj48aSBjbGFzcz1cImZhIGZhLXVzZXJcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+IHt7IGN0cmwuZm9sbG93ZXJzLmxlbmd0aCB9fSBGb2xsb3dlcnMgeW91IGtub3c8L3NwYW4+JyxcbiAgICAgICAgICAgICcgICA8L2hlYWRlcj4nLFxuICAgICAgICAgICAgJyAgIDxzZWN0aW9uPicsXG4gICAgICAgICAgICAnICAgICAgIDxmb2xsb3dlcnMta25vdyBuZy1yZXBlYXQ9XCJmb2xsb3cgaW4gY3RybC5mb2xsb3dlcnMgdHJhY2sgYnkgJGluZGV4XCI+PC9mb2xsb3dlcnMta25vdz4nLFxuICAgICAgICAgICAgJyAgIDwvc2VjdGlvbj4nLFxuICAgICAgICAgICAgJzwvc2VjdGlvbj4nXG4gICAgICAgIF0uam9pbignJyksXG4gICAgICAgIGNvbnRyb2xsZXJBczogJ2N0cmwnLFxuICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiBwcm9maWxlRm9sbG93ZXJzS25vd0NvbnRyb2xsZXIoaGVscFNlcnZpY2UpIHtcblxuICAgICAgICAgICAgdGhpcy5mb2xsb3dlcnMgPSBuZXcgQXJyYXkoaGVscFNlcnZpY2UucmFuZG9tKDE2KSk7XG5cbiAgICAgICAgfVxuICAgIH07XG5cbn0pOyIsInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLmRpcmVjdGl2ZXMnKTtcblxuYXBwLmRpcmVjdGl2ZSgnbmF2YmFySWNvbicsIGZ1bmN0aW9uIG5hdmJhckljb24oKSB7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdCA6ICdFJyxcbiAgICAgICAgdGVtcGxhdGUgOiBbXG4gICAgICAgICAgICAnPGkgY2xhc3M9XCJmYSBmYS0yeCBmYS10d2l0dGVyIG5hdmJhci1pY29uXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPidcbiAgICAgICAgXS5qb2luKCcnKVxuICAgIH07XG5cbn0pOyIsInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLmRpcmVjdGl2ZXMnKTtcblxuYXBwLmRpcmVjdGl2ZSgnbmF2YmFyT3B0aW9uJywgZnVuY3Rpb24gbmF2YmFyT3B0aW9uKCkge1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3QgOiAnRScsXG4gICAgICAgIHJlcGxhY2U6IHRydWUsXG4gICAgICAgIHNjb3BlOiB7fSxcbiAgICAgICAgdGVtcGxhdGUgOiBbXG4gICAgICAgICAgICAnPGxpPicsXG4gICAgICAgICAgICAnICAgPGEgaHJlZj1cIiNcIj4nLFxuICAgICAgICAgICAgJyAgICAgICA8c3BhbiBjbGFzcz1cImdseXBoaWNvbiBnbHlwaGljb24taG9tZVwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvc3Bhbj4nLFxuICAgICAgICAgICAgJyAgICAgICB7eyB0aXRsZSB9fScsXG4gICAgICAgICAgICAnICAgPC9hPicsXG4gICAgICAgICAgICAnPC9saT4nXG4gICAgICAgIF0uam9pbignJyksXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICBzY29wZS50aXRsZSA9IGF0dHJzLnRpdGxlO1xuICAgICAgICB9XG4gICAgfTtcblxufSk7IiwidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycpO1xuXG5hcHAuZGlyZWN0aXZlKCduYXZiYXJTZWFyY2gnLCBmdW5jdGlvbiBuYXZiYXJTZWFyY2goKSB7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdCA6ICdFJyxcbiAgICAgICAgdGVtcGxhdGUgOiBbXG4gICAgICAgICAgICAnPGZvcm0+JyxcbiAgICAgICAgICAgICcgICA8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImZvcm0tY29udHJvbCBtb2Qtc2VhcmNoXCIgcGxhY2Vob2xkZXI9XCJTZWFyY2ggVHdpdHRlclwiIC8+JyxcbiAgICAgICAgICAgICc8L2Zvcm0+J1xuICAgICAgICBdLmpvaW4oJycpXG4gICAgfTtcblxufSk7IiwidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycpO1xuXG5hcHAuZGlyZWN0aXZlKCdwcm9maWxlQ291bnQnLCBmdW5jdGlvbiBwcm9maWxlQ291bnQoKSB7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdCA6ICdFJyxcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgIGNvdW50OiAnPSdcbiAgICAgICAgfSxcbiAgICAgICAgdGVtcGxhdGUgOiBbXG4gICAgICAgICAgICAnICAgPGFydGljbGUgY2xhc3M9XCJwcm9maWxlLWNvdW50XCI+JyxcbiAgICAgICAgICAgICcgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPicsXG4gICAgICAgICAgICAnICAgICAgICAgICA8c3BhbiBjbGFzcz1cInByb2ZpbGUtY291bnQtdGl0bGVcIj57eyB0aXRsZSB9fTwvc3Bhbj4nLFxuICAgICAgICAgICAgJyAgICAgICA8L2Rpdj4nLFxuICAgICAgICAgICAgJyAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+JyxcbiAgICAgICAgICAgICcgICAgICAgICAgIDxzcGFuIGNsYXNzPVwicHJvZmlsZS1jb3VudC1kYXRhXCI+e3sgY291bnQgfX08L3NwYW4+JyxcbiAgICAgICAgICAgICcgICAgICAgPC9kaXY+JyxcbiAgICAgICAgICAgICcgICA8L2FydGljbGU+J1xuICAgICAgICBdLmpvaW4oJycpLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgc2NvcGUudGl0bGUgPSBhdHRycy50aXRsZTtcbiAgICAgICAgICAgIGlmIChhdHRycy5hY3RpdmUpIGVsZW1lbnQuZmluZCgnYXJ0aWNsZScpLmFkZENsYXNzKCdtb2QtYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG59KTsiLCJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJyk7XG5cbmFwcC5kaXJlY3RpdmUoJ3Byb2ZpbGVJbWcnLCBmdW5jdGlvbiBwcm9maWxlSW1nKCRmaWx0ZXIpIHtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0IDogJ0UnLFxuICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgbGluazogJz0nXG4gICAgICAgIH0sXG4gICAgICAgIHRlbXBsYXRlIDogW1xuICAgICAgICAgICAgJzxpbWcgbmctc3JjPVwie3sgbGluayB9fVwiIC8+J1xuICAgICAgICBdLmpvaW4oJycpLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuXG4gICAgICAgICAgICBlbGVtZW50LmZpbmQoJ2ltZycpLmFkZENsYXNzKGF0dHJzLmNsYXNzSW1nKTtcblxuICAgICAgICAgICAgdmFyIHN0b3BXYXRjaCA9IHNjb3BlLiR3YXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLmxpbms7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFzY29wZS5saW5rKSByZXR1cm47XG4gICAgICAgICAgICAgICAgaWYgKGF0dHJzLnJlbW92ZVRleHQpIHNjb3BlLmxpbmsgPSAkZmlsdGVyKCdyZW1vdmVUZXh0Jykoc2NvcGUubGluaywgYXR0cnMucmVtb3ZlVGV4dCk7XG4gICAgICAgICAgICAgICAgc3RvcFdhdGNoKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG4gICAgfTtcblxufSk7IiwidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycpO1xuXG5hcHAuZGlyZWN0aXZlKCdwcm9maWxlVHJlbmRzJywgZnVuY3Rpb24gcHJvZmlsZVRyZW5kcygpIHtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0IDogJ0UnLFxuICAgICAgICB0ZW1wbGF0ZSA6IFtcbiAgICAgICAgICAgICc8c2VjdGlvbiBjbGFzcz1cInByb2ZpbGUtdHJlbmRzLWNvbnRhaW5lciBjb2wtbWQtMTJcIj4nLFxuICAgICAgICAgICAgJyAgIDxoZWFkZXIgY2xhc3M9XCJwcm9maWxlLXRyZW5kcy1jb250YWluZXItaGVhZGVyXCI+JyxcbiAgICAgICAgICAgICcgICAgICAgVHJlbmRzJyxcbiAgICAgICAgICAgICcgICA8L2hlYWRlcj4nLFxuICAgICAgICAgICAgJyAgIDxzZWN0aW9uPicsXG4gICAgICAgICAgICAnICAgICAgIDx0cmVuZCBoYXNoPVwiQW5ndWxhckpTXCIgY291bnQ9XCIyLDE0N1wiPjwvdHJlbmQ+JyxcbiAgICAgICAgICAgICcgICAgICAgPHRyZW5kIGhhc2g9XCJSZWFjdFwiIGNvdW50PVwiNCwzMDNcIj48L3RyZW5kPicsXG4gICAgICAgICAgICAnICAgICAgIDx0cmVuZCBoYXNoPVwiRmVsaXBwZU5hQjJXXCIgY291bnQ9XCIxLDkwNlwiPjwvdHJlbmQ+JyxcbiAgICAgICAgICAgICcgICAgICAgPHRyZW5kIGhhc2g9XCJCMldEaWdpdGFsXCIgY291bnQ9XCI3LDk4N1wiPjwvdHJlbmQ+JyxcbiAgICAgICAgICAgICcgICAgICAgPHRyZW5kIGhhc2g9XCJGcm9udEVuZENhcmlvY2FcIiBjb3VudD1cIjIwOFwiPjwvdHJlbmQ+JyxcbiAgICAgICAgICAgICcgICAgICAgPHRyZW5kIGhhc2g9XCJGcm9udEluUmlvXCIgY291bnQ9XCIyNDNcIj48L3RyZW5kPicsXG4gICAgICAgICAgICAnICAgICAgIDx0cmVuZCBoYXNoPVwiU3VibWFyaW5vQ29tXCIgY291bnQ9XCI4Niw0NTZcIj48L3RyZW5kPicsXG4gICAgICAgICAgICAnICAgICAgIDx0cmVuZCBoYXNoPVwiQmxhY2tGcmlkYXlcIiBjb3VudD1cIjM0N1wiPjwvdHJlbmQ+JyxcbiAgICAgICAgICAgICcgICAgICAgPHRyZW5kIGhhc2g9XCJCMldJbnRlcnZpZXdcIiBjb3VudD1cIjksNjUxXCI+PC90cmVuZD4nLFxuICAgICAgICAgICAgJyAgICAgICA8dHJlbmQgaGFzaD1cIkphdmFTY3JpcHRTMlwiIGNvdW50PVwiMjM0XCI+PC90cmVuZD4nLFxuICAgICAgICAgICAgJyAgIDwvc2VjdGlvbj4nLFxuICAgICAgICAgICAgJzwvc2VjdGlvbj4nXG4gICAgICAgIF0uam9pbignJylcbiAgICB9O1xuXG59KTsiLCJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJyk7XG5cbmFwcC5kaXJlY3RpdmUoJ3RyZW5kJywgZnVuY3Rpb24gdHJlbmQoKSB7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdCA6ICdFJyxcbiAgICAgICAgc2NvcGU6IHt9LFxuICAgICAgICB0ZW1wbGF0ZSA6IFtcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiY29sLW1kLTEyIHByb2ZpbGUtdHJlbmRcIj4nLFxuICAgICAgICAgICAgJyAgIDxkaXYgY2xhc3M9XCJyb3dcIj4nLFxuICAgICAgICAgICAgJyAgICAgICA8c3BhbiBjbGFzcz1cInByb2ZpbGUtdHJlbmQtaGFzaHRhZ1wiPnt7IGhhc2ggfCBoYXNodGFnIH19PC9zcGFuPicsXG4gICAgICAgICAgICAnICAgPC9kaXY+JyxcbiAgICAgICAgICAgICcgICA8ZGl2IGNsYXNzPVwicm93XCI+JyxcbiAgICAgICAgICAgICcgICAgICAgPHNwYW4gY2xhc3M9XCJwcm9maWxlLXRyZW5kLWNvdW50XCI+e3sgY291bnQgfX0gVHdlZXRzPC9zcGFuPicsXG4gICAgICAgICAgICAnICAgPC9kaXY+JyxcbiAgICAgICAgICAgICc8L2Rpdj4nXG4gICAgICAgIF0uam9pbignJyksXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICBzY29wZS5oYXNoID0gYXR0cnMuaGFzaDtcbiAgICAgICAgICAgIHNjb3BlLmNvdW50ID0gYXR0cnMuY291bnQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG59KTsiLCJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJyk7XG5cbmFwcC5kaXJlY3RpdmUoJ3Bob3Rvc1ZpZGVvcycsIGZ1bmN0aW9uIHBob3Rvc1ZpZGVvcygpIHtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0IDogJ0UnLFxuICAgICAgICB0ZW1wbGF0ZSA6IFtcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiY29sLW1kLTQgcHJvZmlsZS1waG90b3NcIj4nLFxuICAgICAgICAgICAgJyAgIDxpbWcgY2xhc3M9XCJwcm9maWxlLXBob3Rvcy1pbWdcIiBzcmM9XCJpbWFnZXMvcGhvdG8tYW5kLXZpZGVvcy5qcGdcIiAvPicsXG4gICAgICAgICAgICAnPC9kaXY+J1xuICAgICAgICBdLmpvaW4oJycpXG4gICAgfTtcblxufSk7IiwidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycpO1xuXG5hcHAuZGlyZWN0aXZlKCdwcm9maWxlUGhvdG9zVmlkZW9zJywgZnVuY3Rpb24gcHJvZmlsZVBob3Rvc1ZpZGVvcygpIHtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0IDogJ0UnLFxuICAgICAgICBzY29wZToge30sXG4gICAgICAgIHRlbXBsYXRlIDogW1xuICAgICAgICAgICAgJzxzZWN0aW9uIGNsYXNzPVwicHJvZmlsZS1waG90b3MtY29udGFpbmVyXCI+JyxcbiAgICAgICAgICAgICcgICA8aGVhZGVyIGNsYXNzPVwicHJvZmlsZS1waG90b3MtaGVhZGVyXCI+JyxcbiAgICAgICAgICAgICcgICAgICAgPHNwYW4+PGkgY2xhc3M9XCJmYSBmYS1jYW1lcmFcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+IHt7IGN0cmwucGhvdG9zLmxlbmd0aCB9fSBwaG90b3MgYW5kIHZpZGVvczwvc3Bhbj4nLFxuICAgICAgICAgICAgJyAgIDwvaGVhZGVyPicsXG4gICAgICAgICAgICAnICAgPHNlY3Rpb24+JyxcbiAgICAgICAgICAgICcgICAgICAgPHBob3Rvcy12aWRlb3MgbmctcmVwZWF0PVwicGhvdG8gaW4gY3RybC5waG90b3MgdHJhY2sgYnkgJGluZGV4XCI+PC9waG90b3MtdmlkZW9zPicsXG4gICAgICAgICAgICAnICAgPC9zZWN0aW9uPicsXG4gICAgICAgICAgICAnPC9zZWN0aW9uPidcbiAgICAgICAgXS5qb2luKCcnKSxcbiAgICAgICAgY29udHJvbGxlckFzOiAnY3RybCcsXG4gICAgICAgIGNvbnRyb2xsZXI6IGZ1bmN0aW9uIHByb2ZpbGVQaG90b3NWaWRlb3NDb250cm9sbGVyKGhlbHBTZXJ2aWNlKSB7XG5cbiAgICAgICAgICAgIHRoaXMucGhvdG9zID0gbmV3IEFycmF5KGhlbHBTZXJ2aWNlLnJhbmRvbSg5KSk7XG5cbiAgICAgICAgfVxuICAgIH07XG5cbn0pOyIsInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLmRpcmVjdGl2ZXMnKTtcblxuYXBwLmRpcmVjdGl2ZSgncHJvZmlsZVR3ZWV0cycsIGZ1bmN0aW9uIHByb2ZpbGVUd2VldHMoKSB7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdCA6ICdFJyxcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgIHR3ZWV0czogJz0nLFxuICAgICAgICAgICAgdHdlZXRzSGVhZGVyT3B0aW9uczogJz0nXG4gICAgICAgIH0sXG4gICAgICAgIHRlbXBsYXRlIDogW1xuICAgICAgICAgICAgJzxzZWN0aW9uIGNsYXNzPVwiY29sLW1kLTEyIGNvbC1zbS0xMiBjb2wteHMtMTIgcHJvZmlsZS10d2VldHMtY29udGFpbmVyXCI+JyxcbiAgICAgICAgICAgICcgICA8aGVhZGVyIGNsYXNzPVwicHJvZmlsZS10d2VldHMtaGVhZGVyXCI+JyxcbiAgICAgICAgICAgICcgICAgICAgPHR3ZWV0cy1oZWFkZXItb3B0aW9uIG5nLXJlcGVhdD1cImhlYWRlck9wdGlvbiBpbiB0d2VldHNIZWFkZXJPcHRpb25zXCIgdGV4dD1cImhlYWRlck9wdGlvbi50ZXh0XCIgYWN0aXZlPVwiaGVhZGVyT3B0aW9uLmFjdGl2ZVwiIGluZGV4PVwiJGluZGV4XCI+PC90d2VldHMtaGVhZGVyLW9wdGlvbj4nLFxuICAgICAgICAgICAgJyAgIDwvaGVhZGVyPicsXG4gICAgICAgICAgICAnICAgPHNlY3Rpb24+JyxcbiAgICAgICAgICAgICcgICAgICAgPHR3ZWV0IG5nLXJlcGVhdD1cInR3ZWV0IGluIHR3ZWV0cyB0cmFjayBieSAkaW5kZXhcIiB0d2VldD1cInR3ZWV0XCI+PC90d2VldD4nLFxuICAgICAgICAgICAgJyAgIDwvc2VjdGlvbj4nLFxuICAgICAgICAgICAgJyAgIDxkaXYgaW5maW5pdGUtc2Nyb2xsPVwiY3RybC5tb3JlVHdlZXRzKClcIiBpbmZpbml0ZS1zY3JvbGwtZGlzdGFuY2U9XCIwXCI+PC9kaXY+JyxcbiAgICAgICAgICAgICc8L3NlY3Rpb24+J1xuICAgICAgICBdLmpvaW4oJycpLFxuICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiBwcm9maWxlVHdlZXRzQ29udHJvbGxlcigkc2NvcGUpIHtcblxuICAgICAgICAgICAgdGhpcy5tb3JlVHdlZXRzID0gZnVuY3Rpb24gbW9yZVR3ZWV0cygpIHtcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS50d2VldHMpIHJldHVybjtcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHBhcmVudC5jdHJsLm1vcmVUd2VldHMoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMuc2VsZWN0VHdlZXRzSGVhZGVyT3B0aW9uID0gZnVuY3Rpb24gc2VsZWN0VHdlZXRzSGVhZGVyT3B0aW9uKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRwYXJlbnQuY3RybC5zZWxlY3RIZWFkZXJPcHRpb25zQWN0aXZlKGluZGV4KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgfSxcbiAgICAgICAgY29udHJvbGxlckFzOiAnY3RybCdcblxuICAgIH07XG5cbn0pOyIsInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLmRpcmVjdGl2ZXMnKTtcblxuYXBwLmRpcmVjdGl2ZSgndHdlZXRzSGVhZGVyT3B0aW9uJywgZnVuY3Rpb24gdHdlZXRzSGVhZGVyT3B0aW9uKCkge1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3QgOiAnRScsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBhY3RpdmU6ICc9JyxcbiAgICAgICAgICAgIHRleHQ6ICc9JyxcbiAgICAgICAgICAgIGluZGV4OiAnPSdcbiAgICAgICAgfSxcbiAgICAgICAgdGVtcGxhdGUgOiBbXG4gICAgICAgICAgICAnPHNlY3Rpb24gY2xhc3M9XCJwcm9maWxlLXR3ZWV0cy1vcHRpb25cIiBuZy1jbGFzcz1cInsgXFwnbW9kLWFjdGl2ZVxcJyA6IGFjdGl2ZSB9XCIgbmctY2xpY2s9XCJjdHJsLnNlbGVjdEhlYWRlck9wdGlvbigpXCI+JyxcbiAgICAgICAgICAgICcgICA8c3Bhbj57eyB0ZXh0IH19PC9zcGFuPicsXG4gICAgICAgICAgICAnPC9zZWN0aW9uPidcbiAgICAgICAgXS5qb2luKCcnKSxcbiAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24gdHdlZXRzSGVhZGVyT3B0aW9uQ29udHJvbGxlcigkc2NvcGUpIHtcblxuICAgICAgICAgICAgdGhpcy5zZWxlY3RIZWFkZXJPcHRpb24gPSBmdW5jdGlvbiBzZWxlY3RIZWFkZXJPcHRpb24oKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLiRwYXJlbnQuY3RybC5zZWxlY3RUd2VldHNIZWFkZXJPcHRpb24oJHNjb3BlLmluZGV4KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgfSxcbiAgICAgICAgY29udHJvbGxlckFzOiAnY3RybCdcbiAgICB9O1xuXG59KTsiLCJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJyk7XG5cbmFwcC5kaXJlY3RpdmUoJ3Byb2ZpbGVJbmZvSWNvbicsIGZ1bmN0aW9uIHByb2ZpbGVJbmZvSWNvbigpIHtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0IDogJ0UnLFxuICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgdGV4dDogJz0nXG4gICAgICAgIH0sXG4gICAgICAgIHRlbXBsYXRlIDogW1xuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJyb3cgcHJvZmlsZS1pbmZvLW5hbWUgcHJvZmlsZS1pbmZvLWRhdGFcIj4nLFxuICAgICAgICAgICAgJyAgIDxpIGNsYXNzPVwiZmFcIiBuZy1jbGFzcz1cImljb25cIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+JyxcbiAgICAgICAgICAgICcgICA8c3Bhbj57eyB0ZXh0IH19PC9zcGFuPicsXG4gICAgICAgICAgICAnPC9kaXY+J1xuICAgICAgICBdLmpvaW4oJycpLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgc2NvcGUuaWNvbiA9IGF0dHJzLmljb247XG4gICAgICAgICAgICBpZiAoYXR0cnMuaXNMaW5rKSBlbGVtZW50LmZpbmQoJ3NwYW4nKS5hZGRDbGFzcygncHJvZmlsZS1pbmZvLWRlc2NyaXB0aW9uLXVybCcpO1xuICAgICAgICB9XG4gICAgfTtcblxufSk7XG4iLCJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcC5kaXJlY3RpdmVzJyk7XG5cbmFwcC5kaXJlY3RpdmUoJ3Byb2ZpbGVJbmZvJywgZnVuY3Rpb24gcHJvZmlsZUluZm8oKSB7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdCA6ICdFJyxcbiAgICAgICAgcHJpb3JpdHk6IDEsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICB1c2VyOiAnPSdcbiAgICAgICAgfSxcbiAgICAgICAgdGVtcGxhdGUgOiBbXG4gICAgICAgICAgICAnPHNlY3Rpb24gY2xhc3M9XCJwcm9maWxlLWluZm8tY29udGFpbmVyXCI+JyxcbiAgICAgICAgICAgICcgICA8YXJ0aWNsZT4nLFxuICAgICAgICAgICAgJyAgICAgICA8ZGl2IGNsYXNzPVwicm93IHByb2ZpbGUtaW5mby1uYW1lXCI+JyxcbiAgICAgICAgICAgICcgICAgICAgICAgIDxzcGFuIGNsYXNzPVwicHJvZmlsZS1pbmZvLW5hbWUtdGl0bGVcIj57eyB1c2VyLm5hbWUgfX08L3NwYW4+JyxcbiAgICAgICAgICAgICcgICAgICAgPC9kaXY+JyxcbiAgICAgICAgICAgICcgICAgICAgPGRpdiBjbGFzcz1cInJvdyBwcm9maWxlLWluZm8tbmFtZVwiPicsXG4gICAgICAgICAgICAnICAgICAgICAgICA8c3BhbiBjbGFzcz1cInByb2ZpbGUtaW5mby1uYW1lLWF0XCI+e3sgdXNlci5zY3JlZW5fbmFtZSB8IHNjcmVlbk5hbWUgfX08L3NwYW4+JyxcbiAgICAgICAgICAgICcgICAgICAgPC9kaXY+JyxcbiAgICAgICAgICAgICcgICA8L2FydGljbGU+JyxcbiAgICAgICAgICAgICcgICA8YXJ0aWNsZSBjbGFzcz1cInByb2ZpbGUtaW5mby1kZXNjcmlwdGlvbi1jb250YWluZXJcIj4nLFxuICAgICAgICAgICAgJyAgICAgICA8ZGl2IGNsYXNzPVwicm93IHByb2ZpbGUtaW5mby1uYW1lXCI+JyxcbiAgICAgICAgICAgICcgICAgICAgICAgIDxzcGFuPnt7IHVzZXIuZGVzY3JpcHRpb24gfX08L3NwYW4+JyxcbiAgICAgICAgICAgICcgICAgICAgPC9kaXY+JyxcbiAgICAgICAgICAgICcgICA8L2FydGljbGU+JyxcbiAgICAgICAgICAgICcgICA8YXJ0aWNsZSBjbGFzcz1cInByb2ZpbGUtaW5mby1kZXNjcmlwdGlvbi1jb250YWluZXJcIj4nLFxuICAgICAgICAgICAgJyAgICAgICA8cHJvZmlsZS1pbmZvLWljb24gaWNvbj1cImZhLW1hcC1tYXJrZXJcIiB0ZXh0PVwidXNlci5sb2NhdGlvblwiPjwvcHJvZmlsZS1pbmZvLWljb24+JyxcbiAgICAgICAgICAgICcgICAgICAgPHByb2ZpbGUtaW5mby1pY29uIGljb249XCJmYS1saW5rXCIgdGV4dD1cInVzZXIubmFtZVwiIGlzLWxpbms9XCJ0cnVlXCI+PC9wcm9maWxlLWluZm8taWNvbj4nLFxuICAgICAgICAgICAgJyAgICAgICA8cHJvZmlsZS1pbmZvLWljb24gaWNvbj1cImZhLWNhbGVuZGFyXCIgdGV4dD1cInVzZXIuY3JlYXRlZF9hdFwiPjwvcHJvZmlsZS1pbmZvLWljb24+JyxcbiAgICAgICAgICAgICcgICA8L2FydGljbGU+JyxcbiAgICAgICAgICAgICcgICA8YXJ0aWNsZSBjbGFzcz1cInByb2ZpbGUtaW5mby1kZXNjcmlwdGlvbi1jb250YWluZXJcIj4nLFxuICAgICAgICAgICAgJyAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi10d2VldCBidG4tZnVsbFwiPicsXG4gICAgICAgICAgICAnICAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLXBlbmNpbC1zcXVhcmUtb1wiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT4nLFxuICAgICAgICAgICAgJyAgICAgICAgICAgPHNwYW4+VHdlZXQgdG8ge3sgdXNlci5uYW1lIH19PC9zcGFuPicsXG4gICAgICAgICAgICAnICAgICAgIDwvYnV0dG9uPicsXG4gICAgICAgICAgICAnICAgPC9hcnRpY2xlPicsXG4gICAgICAgICAgICAnPC9zZWN0aW9uPidcbiAgICAgICAgXS5qb2luKCcnKVxuICAgIH07XG5cbn0pOyIsInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLmRpcmVjdGl2ZXMnKTtcblxuYXBwLmRpcmVjdGl2ZSgndHdlZXRJY29uJywgZnVuY3Rpb24gdHdlZXRJY29uKCkge1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3QgOiAnRScsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICB2YWx1ZTogJz0nXG4gICAgICAgIH0sXG4gICAgICAgIHRlbXBsYXRlIDogW1xuICAgICAgICAgICAgJzxpIGNsYXNzPVwiZmFcIiBuZy1jbGFzcz1cImljb25cIiBhcmlhLWhpZGRlbj1cInRydWVcIj4nLFxuICAgICAgICAgICAgJyAgIDxzcGFuIGNsYXNzPVwidHdlZXQtbWFpbi1pY29ucy12YWx1ZVwiIG5nLWlmPVwidmFsdWVcIj57eyB2YWx1ZSB9fTwvc3Bhbj4nLFxuICAgICAgICAgICAgJzwvaT4nXG4gICAgICAgIF0uam9pbignJyksXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICBzY29wZS5pY29uID0gYXR0cnMuaWNvbjtcbiAgICAgICAgfVxuICAgIH07XG5cbn0pOyIsInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwLmRpcmVjdGl2ZXMnKTtcblxuYXBwLmRpcmVjdGl2ZSgndHdlZXRJbWFnZScsIGZ1bmN0aW9uIHR3ZWV0SW1hZ2UoZmxpY2tyLCBoZWxwU2VydmljZSkge1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3QgOiAnRScsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICB0d2VldDogJz0nXG4gICAgICAgIH0sXG4gICAgICAgIHRlbXBsYXRlIDogW1xuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJyb3dcIiBuZy1pZj1cInVybFwiPicsXG4gICAgICAgICAgICAnICAgPGltZyBjbGFzcz1cInByb2ZpbGUtdHdlZXQtaW1hZ2VcIiBuZy1zcmM9XCJ7eyB1cmwgfX1cIiAvPicsXG4gICAgICAgICAgICAnPC9kaXY+J1xuICAgICAgICBdLmpvaW4oJycpLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlKSB7XG5cbiAgICAgICAgICAgIGlmIChzY29wZS50d2VldC5lbnRpdGllcy5oYXNodGFncy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGFnID0gaGVscFNlcnZpY2UuZmlyc3Qoc2NvcGUudHdlZXQuZW50aXRpZXMuaGFzaHRhZ3MpLnRleHQ7XG4gICAgICAgICAgICAgICAgZmxpY2tyLmdldFBob3Rvcyh0YWcpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnVybCA9IGZsaWNrci5nZXRQaG90b1VybChoZWxwU2VydmljZS5maXJzdChyZXNwb25zZS5waG90b3MucGhvdG8pKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUudHdlZXQuZW50aXRpZXMubWVkaWEgJiYgc2NvcGUudHdlZXQuZW50aXRpZXMubWVkaWEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUudXJsID0gaGVscFNlcnZpY2UuZmlyc3Qoc2NvcGUudHdlZXQuZW50aXRpZXMubWVkaWEpLm1lZGlhX3VybDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgfTtcblxufSk7IiwidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAuZGlyZWN0aXZlcycpO1xuXG5hcHAuZGlyZWN0aXZlKCd0d2VldCcsIGZ1bmN0aW9uIHR3ZWV0KCkge1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3QgOiAnRScsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICB0d2VldDogJz0nXG4gICAgICAgIH0sXG4gICAgICAgIHRlbXBsYXRlIDogW1xuICAgICAgICAgICAgJzxhcnRpY2xlIGNsYXNzPVwidHdlZXQtY29udGFpbmVyIGNvbC1tZC0xMiBjb2wtc20tMTIgY29sLXhzLTEyXCI+JyxcbiAgICAgICAgICAgICcgICA8YXNpZGUgY2xhc3M9XCJjb2wtbWQtMiBjb2wtc20tMiB0d2VldC1pbWctY29udGFpbmVyIGhpZGRlbi14c1wiPicsXG4gICAgICAgICAgICAnICAgICAgIDxpbWcgY2xhc3M9XCJ0d2VldC1pbWdcIiBuZy1zcmM9XCJ7eyB0d2VldC51c2VyLnByb2ZpbGVfaW1hZ2VfdXJsIH19XCIgLz4nLFxuICAgICAgICAgICAgJyAgIDwvYXNpZGU+JyxcbiAgICAgICAgICAgICcgICA8bWFpbiBjbGFzcz1cImNvbC1tZC0xMCBjb2wtc20tMTAgY29sLXhzLTEwIHR3ZWV0LW1haW4tY29udGFpbmVyXCI+JyxcbiAgICAgICAgICAgICcgICAgICAgPGRpdiBjbGFzcz1cInJvdyB0d2VldC1tYWluLXJlcGx5XCIgbmctaWY9XCJ0d2VldC5lbnRpdGllcy51c2VyX21lbnRpb25zLmxlbmd0aFwiPicsXG4gICAgICAgICAgICAnICAgICAgICAgICA8c3Bhbj48aSBjbGFzcz1cImZhIGZhLXJlcGx5IGhpZGRlbi14cyBpY29uLXJlcGx5XCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPkluIHJlcGx5IHRvIHt7IHR3ZWV0LmVudGl0aWVzLnVzZXJfbWVudGlvbnNbMF0ubmFtZSB9fTwvc3Bhbj4nLFxuICAgICAgICAgICAgJyAgICAgICA8L2Rpdj4nLFxuICAgICAgICAgICAgJyAgICAgICA8ZGl2IGNsYXNzPVwicm93IHR3ZWV0LW1haW4tcHJvZmlsZS1jb250YWluZXJcIj4nLFxuICAgICAgICAgICAgJyAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0d2VldC1tYWluLXByb2ZpbGUtbmFtZVwiPnt7IHR3ZWV0LnVzZXIubmFtZSB9fTwvc3Bhbj4nLFxuICAgICAgICAgICAgJyAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ0d2VldC1tYWluLXByb2ZpbGUtYXRcIj57eyB0d2VldC51c2VyLnNjcmVlbl9uYW1lIHwgc2NyZWVuTmFtZSB9fTwvc3Bhbj4nLFxuICAgICAgICAgICAgJyAgICAgICA8L2Rpdj4nLFxuICAgICAgICAgICAgJyAgICAgICA8ZGl2IGNsYXNzPVwicm93IHR3ZWV0LW1haW5cIj4nLFxuICAgICAgICAgICAgJyAgICAgICAgICAgPHNwYW4+e3sgdHdlZXQudGV4dCB9fTwvc3Bhbj4nLFxuICAgICAgICAgICAgJyAgICAgICA8L2Rpdj4nLFxuICAgICAgICAgICAgJyAgICAgICA8dHdlZXQtaW1hZ2UgdHdlZXQ9XCJ0d2VldFwiPjwvdHdlZXQtaW1hZ2U+JyxcbiAgICAgICAgICAgICcgICAgICAgPGRpdiBjbGFzcz1cInJvdyB0d2VldC1tYWluLWljb25zXCI+JyxcbiAgICAgICAgICAgICcgICAgICAgICAgIDx0d2VldC1pY29uIGljb249XCJmYS1yZXBseVwiIHZhbHVlPVwidHdlZXQuZW50aXRpZXMudXNlcl9tZW50aW9ucy5sZW5ndGhcIj48L3R3ZWV0LWljb24+JyxcbiAgICAgICAgICAgICcgICAgICAgICAgIDx0d2VldC1pY29uIGljb249XCJmYS1yZXR3ZWV0XCIgdmFsdWU9XCJ0d2VldC5yZXR3ZWV0X2NvdW50XCI+PC90d2VldC1pY29uPicsXG4gICAgICAgICAgICAnICAgICAgICAgICA8dHdlZXQtaWNvbiBpY29uPVwiZmEtaGVhcnRcIiB2YWx1ZT1cInR3ZWV0LmZhdm9yaXRlX2NvdW50XCI+PC90d2VldC1pY29uPicsXG4gICAgICAgICAgICAnICAgICAgICAgICA8dHdlZXQtaWNvbiBpY29uPVwiZmEtZWxsaXBzaXMtaFwiPjwvdHdlZXQtaWNvbj4nLFxuICAgICAgICAgICAgJyAgICAgICA8L2Rpdj4nLFxuICAgICAgICAgICAgJyAgIDwvbWFpbj4nLFxuICAgICAgICAgICAgJzwvYXJ0aWNsZT4nXG4gICAgICAgIF0uam9pbignJylcbiAgICB9O1xuXG59KTsiXX0=
